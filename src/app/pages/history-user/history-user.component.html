<!-- CONTENEDOR PRINCIPAL -->
<div class="w-full px-4 md:px-6 lg:px-8">

    <!-- CARD: Crear Historia de Usuario -->
    <div class="bg-white rounded-2xl shadow-md border border-gray-100 overflow-hidden">
        <!-- Header -->

        <div class="bg-teal-600 px-5 py-3 flex items-center justify-between">
            <h2 class="text-lg md:text-xl font-semibold text-white">Crear Historia de Usuario</h2>
        </div>


        <!-- Body -->
        <div class="p-4 md:p-6">
            <form class="space-y-4" [formGroup]="historiaForm" (ngSubmit)="crearHistoria()">

                <!-- GRID RESPONSIVO -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <!-- Columna izquierda -->
                    <div class="space-y-4">
                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Nombre de la Historia</mat-label>
                            <input matInput type="text" formControlName="nombre_historia" />
                        </mat-form-field>

                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Estado</mat-label>
                            <input matInput type="text" formControlName="estado" />
                        </mat-form-field>

                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Responsable (Correo)</mat-label>
                            <input matInput type="text" formControlName="responsable" />
                        </mat-form-field>

                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>ID Iniciativa</mat-label>
                            <input matInput type="number" formControlName="id_iniciativa" />
                        </mat-form-field>
                    </div>

                    <!-- Columna derecha -->
                    <div class="space-y-4">
                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Descripción</mat-label>
                            <textarea matInput formControlName="descripcion" rows="4"></textarea>
                        </mat-form-field>

                        <mat-form-field appearance="fill" class="w-full">
                            <mat-label>Fase</mat-label>
                            <input matInput type="text" formControlName="fase" />
                        </mat-form-field>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <mat-form-field appearance="fill" class="w-full">
                                <mat-label>Fecha de Inicio</mat-label>
                                <input matInput [matDatepicker]="pickerInicio" formControlName="fecha_inicio" />
                                <mat-datepicker-toggle matSuffix [for]="pickerInicio"></mat-datepicker-toggle>
                                <mat-datepicker #pickerInicio></mat-datepicker>
                            </mat-form-field>

                            <mat-form-field appearance="fill" class="w-full">
                                <mat-label>Fecha de Fin</mat-label>
                                <input matInput [matDatepicker]="pickerFin" formControlName="fecha_fin" />
                                <mat-datepicker-toggle matSuffix [for]="pickerFin"></mat-datepicker-toggle>
                                <mat-datepicker #pickerFin></mat-datepicker>
                            </mat-form-field>
                        </div>
                    </div>
                </div>

                <!-- Checkboxes -->
                <div class="mt-2 flex flex-wrap items-center gap-x-6 gap-y-2">
                    <mat-checkbox formControlName="validacion_fase_1">Validación Fase 1</mat-checkbox>
                    <mat-checkbox formControlName="validacion_fase_2">Validación Fase 2</mat-checkbox>
                    <mat-checkbox formControlName="validacion_fase_n">Validación Fase N</mat-checkbox>
                </div>

                <!-- Botón -->
                <div class="pt-2">
                    <button mat-flat-button color="primary" type="submit" [disabled]="historiaForm.invalid"
                        class="!bg-teal-600 hover:!bg-teal-700 !text-white rounded-xl px-5 py-2 shadow-sm">
                        {{ historiaForm.invalid ? 'Completa los campos' : 'Crear Historia de Usuario' }}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- SEPARADOR -->
    <div class="h-6"></div>

    <!-- CARD: Historias de Usuario Creadas -->
    <div class="bg-white rounded-2xl shadow-md border border-gray-100 overflow-hidden">
        <!-- Header -->
        <div class="bg-teal-600 px-5 py-3">
            <h2 class="text-lg md:text-xl font-semibold text-white">Historias de Usuario Creadas</h2>
        </div>


        <!-- Body -->
        <div class="p-4 md:p-6">
            <!-- Tabla responsiva con scroll horizontal en móviles -->
            <div class="w-full overflow-x-auto">
                <table mat-table [dataSource]="historias" class="min-w-[800px] w-full text-sm">
                    <!-- Columnas -->
                    <ng-container matColumnDef="id_historia">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">ID</th>
                        <td mat-cell *matCellDef="let historia" class="whitespace-nowrap">{{ historia.id_historia }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="nombre_historia">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Nombre</th>
                        <td mat-cell *matCellDef="let historia">{{ historia.nombre_historia }}</td>
                    </ng-container>

                    <ng-container matColumnDef="descripcion">
                        <th mat-header-cell *matHeaderCellDef>Descripción</th>
                        <td mat-cell *matCellDef="let historia" class="max-w-[360px] truncate">
                            {{ historia.descripcion }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="estado">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Estado</th>
                        <td mat-cell *matCellDef="let historia">{{ historia.estado }}</td>
                    </ng-container>

                    <ng-container matColumnDef="fase">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Fase</th>
                        <td mat-cell *matCellDef="let historia">{{ historia.fase }}</td>
                    </ng-container>

                    <ng-container matColumnDef="responsable">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Responsable</th>
                        <td mat-cell *matCellDef="let historia" class="truncate max-w-[220px]">
                            {{ historia.responsable }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="fecha_inicio">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Fecha de Inicio</th>
                        <td mat-cell *matCellDef="let historia" class="whitespace-nowrap">
                            {{ historia.fecha_inicio | date: 'dd/MM/yyyy' }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="fecha_fin">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Fecha de Fin</th>
                        <td mat-cell *matCellDef="let historia" class="whitespace-nowrap">
                            {{ historia.fecha_fin | date: 'dd/MM/yyyy' }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="id_iniciativa">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Iniciativa</th>
                        <td mat-cell *matCellDef="let historia" class="whitespace-nowrap">
                            {{ historia.id_iniciativa }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="validacion_fase_1">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Val. Fase 1</th>
                        <td mat-cell *matCellDef="let h" class="whitespace-nowrap">
                            {{ h.validacion_fase_1 ? 'Sí' : 'No' }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="validacion_fase_2">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Val. Fase 2</th>
                        <td mat-cell *matCellDef="let h" class="whitespace-nowrap">
                            {{ h.validacion_fase_2 ? 'Sí' : 'No' }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="validacion_fase_n">
                        <th mat-header-cell *matHeaderCellDef class="whitespace-nowrap">Val. Fase N</th>
                        <td mat-cell *matCellDef="let h" class="whitespace-nowrap">
                            {{ h.validacion_fase_n ? 'Sí' : 'No' }}
                        </td>
                    </ng-container>

                    <!-- Filas -->
                    <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-gray-50 text-gray-700"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns" class="hover:bg-gray-50"></tr>
                </table>
            </div>
        </div>
    </div>
</div>